<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FUEL">
<title>FUEL</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0d0f;--sur:#151518;--sur2:#1c1c20;--bd:#26262c;--bd2:#34343c;--txt:#dddde8;--muted:#64647a;--dim:#2e2e38;--cal:#c8f135;--cald:rgba(200,241,53,0.07);--prot:#5b6fff;--protd:rgba(91,111,255,0.07);--fat:#f5864a;--fatd:rgba(245,134,74,0.07);--fiber:#2ee89a;--fiberd:rgba(46,232,154,0.07);--water:#22c8f0;--waterd:rgba(34,200,240,0.07);--alc:#c084fc;--alcd:rgba(192,132,252,0.07);--warn:#f55;--r:9px;--rs:6px;--mono:'IBM Plex Mono',monospace;--sans:'IBM Plex Sans',sans-serif}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{background:var(--bg);color:var(--txt);font-family:var(--sans);min-height:100vh;overflow-x:hidden;padding-top:env(safe-area-inset-top);padding-bottom:calc(env(safe-area-inset-bottom)+60px);font-size:14px}
.app{max-width:600px;margin:0 auto;padding:12px 12px 60px}
.hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.logo{font-family:var(--mono);font-size:11px;letter-spacing:.25em;color:var(--muted);text-transform:uppercase}
.sync-dot{width:5px;height:5px;border-radius:50%;background:var(--dim);transition:background .3s}
.sync-dot.ok{background:var(--fiber)}.sync-dot.err{background:var(--warn)}
.date-nav{display:flex;align-items:center;justify-content:space-between;background:var(--sur);border:1px solid var(--bd);border-radius:var(--rs);padding:8px 12px;margin-bottom:9px}
.dnav-btn{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;padding:0 4px;line-height:1}
.dnav-btn:active{color:var(--cal)}.dnav-btn:disabled{opacity:.2;cursor:default}
.dnav-mid{display:flex;flex-direction:column;align-items:center;gap:1px}
.dnav-label{font-family:var(--mono);font-size:12px;font-weight:500;color:var(--txt)}
.dnav-sub{font-family:var(--mono);font-size:9px;color:var(--muted)}
.dnav-today{font-family:var(--mono);font-size:9px;color:var(--cal);background:var(--cald);border:1px solid rgba(200,241,53,.2);border-radius:3px;padding:2px 8px;cursor:pointer;display:none}
.dnav-today.on{display:block}
.dnav-right{display:flex;align-items:center;gap:8px}
.big-bars{display:flex;flex-direction:column;gap:7px;margin-bottom:9px}
.big-bar{background:var(--sur);border:1px solid var(--bd);border-radius:var(--r);padding:12px 14px}
.bb-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.bb-lbl{font-family:var(--mono);font-size:8px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:3px}
.bb-nums{display:flex;align-items:baseline;gap:4px}
.bb-val{font-family:var(--mono);font-size:22px;font-weight:700;line-height:1}
.big-bar.cal .bb-val{color:var(--cal)}.big-bar.prot .bb-val{color:var(--prot)}
.bb-tgt{font-family:var(--mono);font-size:10px;color:var(--dim)}
.bb-pct{font-family:var(--mono);font-size:22px;font-weight:700}
.big-bar.cal .bb-pct{color:var(--cal)}.big-bar.prot .bb-pct{color:var(--prot)}
.btrack{height:5px;background:var(--sur2);border-radius:3px;overflow:hidden}
.bfill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.4,0,.2,1)}
.big-bar.cal .bfill{background:var(--cal)}.big-bar.prot .bfill{background:var(--prot)}
.mini-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-bottom:9px}
.mc2{background:var(--sur);border:1px solid var(--bd);border-radius:var(--r);padding:10px}
.mc2-lbl{font-family:var(--mono);font-size:8px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:2px}
.mc2-val{font-family:var(--mono);font-size:15px;font-weight:700;margin-bottom:1px}
.mc2.fat .mc2-val{color:var(--fat)}.mc2.fiber .mc2-val{color:var(--fiber)}.mc2.water .mc2-val{color:var(--water)}
.mc2-sub{font-family:var(--mono);font-size:8px;color:var(--muted);margin-bottom:5px}
.mtrack{height:2px;background:var(--sur2);border-radius:1px;overflow:hidden}
.mfill{height:100%;border-radius:1px;transition:width .6s cubic-bezier(.4,0,.2,1)}
.mc2.fat .mfill{background:var(--fat)}.mc2.fiber .mfill{background:var(--fiber)}.mc2.water .mfill{background:var(--water)}
.wbtns{display:flex;gap:3px;margin-top:6px}
.wbtn{flex:1;background:var(--sur2);border:1px solid var(--bd);border-radius:4px;color:var(--water);font-family:var(--mono);font-size:10px;padding:3px 2px;cursor:pointer;text-align:center}
.wbtn:active{background:var(--waterd);border-color:var(--water)}
.status-row{display:flex;gap:6px;margin-bottom:9px}
.sbadge{flex:1;background:var(--sur);border:1px solid var(--bd);border-radius:var(--rs);padding:8px 10px;display:flex;align-items:center;gap:5px}
.sdot{width:5px;height:5px;border-radius:50%;flex-shrink:0;background:var(--dim)}
.slbl{font-family:var(--mono);color:var(--muted);font-size:10px}
.sval{font-family:var(--mono);font-size:11px;font-weight:600}
.assess{background:var(--sur);border:1px solid var(--bd);border-radius:var(--r);padding:10px 12px;margin-bottom:9px;display:none}
.assess.on{display:block}
.assess-top{display:flex;align-items:center;gap:7px;margin-bottom:3px}
.assess-icon{font-size:14px}.assess-stat{font-size:11px;font-weight:600}
.assess-note{font-family:var(--mono);font-size:10px;color:var(--muted);line-height:1.5}
.sec{font-family:var(--mono);font-size:8px;letter-spacing:.18em;text-transform:uppercase;color:var(--dim);margin:14px 0 6px}
.quick-row{display:flex;gap:6px;margin-bottom:9px;flex-wrap:wrap}
.qbtn{background:var(--sur);border:1px solid var(--bd);border-radius:var(--rs);padding:8px 12px;font-family:var(--mono);font-size:10px;color:var(--muted);cursor:pointer;display:flex;align-items:center;gap:5px;white-space:nowrap}
.qbtn:active{border-color:var(--cal);color:var(--cal);background:var(--cald)}
.log-panel{background:var(--sur);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;margin-bottom:10px}
.log-tabs{display:flex;border-bottom:1px solid var(--bd);overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.log-tabs::-webkit-scrollbar{display:none}
.ltab{flex:1;min-width:64px;padding:9px 4px;background:none;border:none;border-bottom:2px solid transparent;margin-bottom:-1px;color:var(--muted);font-family:var(--mono);font-size:9px;cursor:pointer;white-space:nowrap;text-align:center;letter-spacing:.04em}
.ltab.active{color:var(--cal);border-bottom-color:var(--cal);background:var(--cald)}
.lpane{display:none}.lpane.active{display:block}
.chips{display:flex;gap:5px;padding:10px 11px 0;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.chips::-webkit-scrollbar{display:none}
.chip{flex-shrink:0;padding:5px 13px;border-radius:16px;border:1px solid var(--bd);background:none;color:var(--muted);font-size:11px;font-family:var(--sans);font-weight:500;cursor:pointer}
.chip.active{border-color:var(--cal);background:var(--cald);color:var(--cal)}
.chip.drink-chip{border-color:var(--alc);background:var(--alcd);color:var(--alc)}
.iw{padding:8px 11px}
textarea.ti{width:100%;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--txt);font-family:var(--mono);font-size:12px;padding:9px 10px;resize:none;min-height:64px;outline:none;line-height:1.6;-webkit-appearance:none}
textarea.ti::placeholder{color:var(--dim)}
textarea.ni{width:100%;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--txt);font-family:var(--mono);font-size:11px;padding:6px 10px;resize:none;height:34px;outline:none;margin-top:5px;-webkit-appearance:none}
textarea.ni::placeholder{color:var(--dim)}
.pdrop{border:1px dashed var(--bd2);border-radius:var(--rs);padding:20px 12px;text-align:center;cursor:pointer;position:relative}
.pdrop input{position:absolute;inset:0;opacity:0;cursor:pointer}
.pdrop p{color:var(--muted);font-size:12px;margin-top:4px}
.pdrop small{font-family:var(--mono);font-size:9px;color:var(--dim)}
.pprev{display:none;margin-top:8px}
.pprev img{max-width:100%;max-height:120px;border-radius:var(--rs);border:1px solid var(--bd);object-fit:cover}
.vc{text-align:center;padding:14px 0 6px}
.vbtn{width:52px;height:52px;border-radius:50%;border:1px solid var(--bd);background:var(--sur2);cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-size:18px;margin-bottom:6px}
.vbtn.rec{border-color:var(--warn);background:rgba(255,85,85,.1);animation:pulse 1s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.vstatus{font-family:var(--mono);font-size:10px;color:var(--muted)}
.vtx{margin:8px 11px 0;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);padding:8px;font-family:var(--mono);font-size:11px;min-height:36px;display:none;line-height:1.5}
.la{display:flex;align-items:center;justify-content:space-between;padding:8px 11px 11px}
.hint{font-family:var(--mono);font-size:9px;color:var(--dim)}
.btn-az{background:var(--cal);color:#0d0d0f;border:none;padding:9px 20px;border-radius:var(--rs);font-family:var(--sans);font-weight:600;font-size:12px;cursor:pointer;-webkit-appearance:none}
.btn-az:active{opacity:.8}.btn-az:disabled{opacity:.35;cursor:not-allowed}
.hl{padding:6px 11px 11px;display:flex;flex-direction:column;gap:5px}
.hi{background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);padding:8px 10px;display:flex;align-items:center;gap:8px}
.hi-info{flex:1;min-width:0}
.hi-name{font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.hi-meta{font-family:var(--mono);font-size:9px;color:var(--muted);margin-top:1px}
.hi-nums{font-family:var(--mono);font-size:9px;text-align:right;line-height:1.7;flex-shrink:0}
.hc{color:var(--cal)}.hp{color:var(--prot)}
.hi-add{width:24px;height:24px;border-radius:50%;border:1px solid var(--bd);background:none;color:var(--muted);font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.hi-add:active{border-color:var(--cal);color:var(--cal)}
.air{background:var(--sur);border:1px solid var(--bd2);border-radius:var(--r);padding:12px;margin-bottom:10px;display:none}
.air.on{display:block;animation:fu .2s ease}
@keyframes fu{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.air-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:9px}
.air-ttl{font-family:var(--mono);font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);display:flex;align-items:center;gap:5px}
.aichip{background:var(--cald);color:var(--cal);border:1px solid rgba(200,241,53,.2);padding:2px 6px;border-radius:3px;font-size:8px}
.air-nums{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:8px}
.anv{font-family:var(--mono);font-size:16px;font-weight:700}
.anv.c{color:var(--cal)}.anv.p{color:var(--prot)}.anv.f{color:var(--fat)}.anv.fi{color:var(--fiber)}
.anl{font-family:var(--mono);font-size:8px;color:var(--muted);margin-top:1px}
.air-desc{font-family:var(--mono);font-size:10px;color:var(--muted);line-height:1.5;margin-bottom:9px}
.egrid{display:grid;grid-template-columns:repeat(2,1fr);gap:5px;margin-bottom:8px}
.ef label{font-family:var(--mono);font-size:8px;color:var(--dim);display:block;margin-bottom:2px;text-transform:uppercase;letter-spacing:.1em}
.ef input{width:100%;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--txt);font-family:var(--mono);font-size:13px;font-weight:600;padding:6px 9px;outline:none;-webkit-appearance:none}
.air-acts{display:flex;gap:6px}
.btn-ok{flex:1;background:var(--fiber);color:#0d0d0f;border:none;padding:10px;border-radius:var(--rs);font-family:var(--sans);font-weight:600;font-size:12px;cursor:pointer}
.btn-ok:active{opacity:.85}
.btn-no{background:none;border:1px solid var(--bd);color:var(--muted);padding:10px 13px;border-radius:var(--rs);font-family:var(--sans);font-size:11px;cursor:pointer}
.meals{display:flex;flex-direction:column;gap:6px}
.mcard{background:var(--sur);border:1px solid var(--bd);border-radius:var(--r);padding:10px 12px;animation:fu .2s ease}
.mcard-top{display:flex;align-items:flex-start;gap:7px}
.mbadge{font-family:var(--mono);font-size:7px;letter-spacing:.1em;text-transform:uppercase;padding:2px 5px;border-radius:3px;flex-shrink:0;margin-top:2px}
.mbadge.breakfast{background:rgba(255,190,40,.12);color:#ffbe28}
.mbadge.lunch{background:var(--fiberd);color:var(--fiber)}
.mbadge.dinner{background:var(--protd);color:var(--prot)}
.mbadge.snack{background:var(--fatd);color:var(--fat)}
.mbadge.drink{background:var(--alcd);color:var(--alc)}
.mcard-body{flex:1;min-width:0}
.mcard-desc{font-size:12px;font-weight:600;line-height:1.35}
.mcard-note{font-family:var(--mono);font-size:9px;color:var(--muted);margin-top:2px;font-style:italic}
.mcard-time{font-family:var(--mono);font-size:9px;color:var(--dim);margin-top:1px}
.mcard-acts{display:flex;gap:3px;flex-shrink:0}
.mab{background:none;border:1px solid var(--bd);border-radius:4px;color:var(--muted);font-size:11px;width:24px;height:24px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.mab:active{border-color:var(--prot);color:var(--prot)}.mab.del:active{border-color:var(--warn);color:var(--warn)}
.mcard-macros{display:flex;gap:9px;margin-top:8px;padding-top:8px;border-top:1px solid var(--bd)}
.mm{display:flex;flex-direction:column}
.mmv{font-family:var(--mono);font-size:11px;font-weight:700}
.mml{font-family:var(--mono);font-size:7px;color:var(--dim)}
.mm.cal .mmv{color:var(--cal);font-size:13px}.mm.prot .mmv{color:var(--prot)}.mm.fat .mmv{color:var(--fat)}.mm.fiber .mmv{color:var(--fiber)}
.plan-box{background:var(--sur);border:1px solid var(--bd);border-radius:var(--r);overflow:hidden;margin-bottom:10px}
.plan-tabs{display:flex;border-bottom:1px solid var(--bd);overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.plan-tabs::-webkit-scrollbar{display:none}
.ptab{flex:1;min-width:80px;padding:9px 4px;background:none;border:none;border-bottom:2px solid transparent;margin-bottom:-1px;color:var(--muted);font-family:var(--mono);font-size:9px;cursor:pointer;white-space:nowrap;text-align:center}
.ptab.active{color:var(--fiber);border-bottom-color:var(--fiber);background:var(--fiberd)}
.ppane{display:none;padding:12px}.ppane.active{display:block}
.dinner-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.dinner-sub{font-family:var(--mono);font-size:9px;color:var(--muted)}
.btn-dinner{background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--cal);font-family:var(--mono);font-size:9px;padding:5px 11px;cursor:pointer}
.btn-dinner:disabled{opacity:.4;cursor:not-allowed}
.dinner-cards{display:flex;flex-direction:column;gap:6px}
.dcard{background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);padding:10px;cursor:pointer}
.dcard:active{border-color:var(--fiber)}
.dcard-top{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:5px}
.dcard-name{font-size:12px;font-weight:600;line-height:1.3;flex:1}
.dbadge{font-family:var(--mono);font-size:8px;padding:2px 6px;border-radius:3px;flex-shrink:0}
.dbadge.high{background:var(--protd);color:var(--prot)}.dbadge.balanced{background:var(--fiberd);color:var(--fiber)}.dbadge.light{background:var(--cald);color:var(--cal)}
.dcard-macros{display:flex;gap:10px}
.dm{font-family:var(--mono);font-size:10px}
.dm.c{color:var(--cal)}.dm.p{color:var(--prot)}.dm.f{color:var(--fat)}
.dcard-note{font-family:var(--mono);font-size:9px;color:var(--muted);margin-top:4px;line-height:1.4}
.dcard-tap{font-family:var(--mono);font-size:8px;color:var(--dim);margin-top:4px}
.rest-panel{display:flex;flex-direction:column;gap:8px}
.rest-row{display:flex;gap:6px}
.rest-input{flex:1;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--txt);font-family:var(--mono);font-size:12px;padding:8px 10px;outline:none;-webkit-appearance:none}
.rest-input::placeholder{color:var(--dim)}
.btn-rest{background:var(--fiber);color:#0d0d0f;border:none;padding:8px 14px;border-radius:var(--rs);font-family:var(--sans);font-weight:600;font-size:11px;cursor:pointer;flex-shrink:0;white-space:nowrap}
.btn-rest:disabled{opacity:.35;cursor:not-allowed}
.rest-toggle{background:none;border:none;color:var(--muted);font-family:var(--mono);font-size:9px;cursor:pointer;text-align:left;text-decoration:underline}
textarea.rest-menu{width:100%;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--txt);font-family:var(--mono);font-size:11px;padding:8px 10px;resize:none;height:68px;outline:none;display:none;-webkit-appearance:none}
textarea.rest-menu.on{display:block}
.rest-courses{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.rcl{font-family:var(--mono);font-size:9px;color:var(--muted);flex-shrink:0}
.rcbtn{background:none;border:1px solid var(--bd);border-radius:12px;color:var(--muted);font-family:var(--mono);font-size:9px;padding:3px 10px;cursor:pointer}
.rcbtn.active{border-color:var(--fiber);background:var(--fiberd);color:var(--fiber)}
.rest-results{display:flex;flex-direction:column;gap:6px}
.rcard{background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);padding:10px;cursor:pointer}
.rcard:active{border-color:var(--fiber)}
.rcard-course{font-family:var(--mono);font-size:8px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);margin-bottom:3px}
.rcard-name{font-size:12px;font-weight:600;margin-bottom:4px;line-height:1.3}
.rcard-macros{display:flex;gap:10px;margin-bottom:3px}
.rcard-note{font-family:var(--mono);font-size:9px;color:var(--muted);line-height:1.4}
.rcard-tap{font-family:var(--mono);font-size:8px;color:var(--dim);margin-top:4px}
.rest-combo{background:var(--sur2);border:1px solid var(--fiber);border-radius:var(--rs);padding:10px;margin-top:2px}
.rest-combo-lbl{font-family:var(--mono);font-size:8px;letter-spacing:.1em;text-transform:uppercase;color:var(--fiber);margin-bottom:4px}
.rest-combo-name{font-size:12px;font-weight:600;margin-bottom:4px}
.rest-combo-macros{display:flex;gap:10px}
.rest-combo-note{font-family:var(--mono);font-size:9px;color:var(--muted);margin-top:4px;line-height:1.4}
.h2h-inputs{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
.h2h-slot{background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);padding:9px;display:flex;flex-direction:column;gap:5px}
.h2h-lbl{font-family:var(--mono);font-size:8px;letter-spacing:.1em;text-transform:uppercase;color:var(--dim)}
.h2h-type-row{display:flex;gap:3px}
.h2h-type{flex:1;background:none;border:1px solid var(--bd);border-radius:4px;color:var(--muted);font-family:var(--mono);font-size:9px;padding:4px 2px;cursor:pointer;text-align:center}
.h2h-type.active{border-color:var(--prot);background:var(--protd);color:var(--prot)}
textarea.h2h-txt{width:100%;background:var(--bg);border:1px solid var(--bd);border-radius:4px;color:var(--txt);font-family:var(--mono);font-size:10px;padding:5px 7px;resize:none;height:52px;outline:none;-webkit-appearance:none}
textarea.h2h-txt::placeholder{color:var(--dim)}
.h2h-img-drop{border:1px dashed var(--bd2);border-radius:4px;padding:14px 8px;text-align:center;cursor:pointer;position:relative;font-size:14px}
.h2h-img-drop input{position:absolute;inset:0;opacity:0;cursor:pointer}
.h2h-img-drop p{font-family:var(--mono);font-size:9px;color:var(--dim);margin-top:3px}
.h2h-img-prev{display:none;margin-top:5px}
.h2h-img-prev img{width:100%;height:52px;object-fit:cover;border-radius:4px;border:1px solid var(--bd)}
.btn-h2h{width:100%;background:var(--prot);color:#fff;border:none;padding:10px;border-radius:var(--rs);font-family:var(--sans);font-weight:600;font-size:12px;cursor:pointer;margin-bottom:8px}
.btn-h2h:disabled{opacity:.35;cursor:not-allowed}
.h2h-result{background:var(--sur2);border:1px solid var(--bd2);border-radius:var(--rs);padding:10px;display:none}
.h2h-result.on{display:block}
.h2h-winner{font-size:13px;font-weight:700;margin-bottom:5px}
.h2h-winner .wn{color:var(--fiber)}
.h2h-compare{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:7px}
.h2h-col{background:var(--bg);border:1px solid var(--bd);border-radius:var(--rs);padding:7px}
.h2h-col.winner{border-color:var(--fiber);background:var(--fiberd)}
.h2h-col-name{font-size:10px;font-weight:600;margin-bottom:5px}
.h2h-mr{display:flex;justify-content:space-between;font-family:var(--mono);font-size:9px;margin-bottom:2px}
.h2h-ml{color:var(--muted)}
.h2h-reasoning{font-family:var(--mono);font-size:10px;color:var(--muted);line-height:1.5}
.wp{background:var(--sur);border:1px solid var(--bd);border-radius:var(--r);padding:13px;margin-top:14px}
.wp-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:11px}
.wp-title{font-size:11px;font-weight:600}
.wp-stats{display:flex;gap:10px}
.wst{font-family:var(--mono);font-size:9px;color:var(--muted)}
.wst span{color:var(--txt)}
.wbars{display:flex;gap:4px;align-items:flex-end;height:46px}
.wd{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;height:100%}
.wbw{flex:1;width:100%;background:var(--sur2);border-radius:3px;display:flex;align-items:flex-end;overflow:hidden}
.wb{width:100%;border-radius:3px 3px 0 0;transition:height .5s cubic-bezier(.4,0,.2,1)}
.wb.over{background:var(--warn)}.wb.good{background:var(--cal);opacity:.55}.wb.low{background:var(--bd)}.wb.today{background:var(--cal)}
.wlbl{font-family:var(--mono);font-size:8px;color:var(--dim);text-transform:uppercase}
.wd.cur .wlbl{color:var(--cal)}
.sumbox{background:var(--sur);border:1px solid var(--bd);border-left:2px solid var(--cal);border-radius:var(--r);padding:11px 13px;margin-top:12px}
.sumlbl{font-family:var(--mono);font-size:8px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:4px;display:flex;align-items:center;gap:5px}
.sumtxt{font-family:var(--mono);font-size:10px;color:var(--muted);line-height:1.6}
.btn-gen{margin-top:7px;background:none;border:1px solid var(--bd);border-radius:var(--rs);color:var(--muted);font-family:var(--mono);font-size:9px;padding:4px 12px;cursor:pointer}
.btn-gen:active{border-color:var(--cal);color:var(--cal)}.btn-gen:disabled{opacity:.4;cursor:not-allowed}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:100;display:none;align-items:flex-end;justify-content:center}
.overlay.on{display:flex}
.modal{background:var(--sur);border:1px solid var(--bd2);border-radius:var(--r) var(--r) 0 0;padding:16px 13px calc(16px + env(safe-area-inset-bottom));width:100%;max-width:600px;animation:su .22s ease}
@keyframes su{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-title{font-size:13px;font-weight:600;margin-bottom:12px}
.mgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-bottom:10px}
.mf label{font-family:var(--mono);font-size:8px;color:var(--dim);display:block;margin-bottom:2px;text-transform:uppercase;letter-spacing:.1em}
.mf input,.mf textarea{width:100%;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--txt);font-family:var(--mono);font-size:12px;padding:6px 9px;outline:none;-webkit-appearance:none}
.mf textarea{resize:none;height:48px;grid-column:span 2}
.macts{display:flex;gap:6px}
.btn-sv{flex:1;background:var(--prot);color:#fff;border:none;padding:10px;border-radius:var(--rs);font-family:var(--sans);font-weight:600;font-size:12px;cursor:pointer}
.btn-cn{background:none;border:1px solid var(--bd);color:var(--muted);padding:10px 16px;border-radius:var(--rs);font-family:var(--sans);font-size:11px;cursor:pointer}
.alc-row{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px}
.alc-cat{flex-shrink:0;padding:5px 11px;border-radius:14px;border:1px solid var(--bd);background:none;color:var(--muted);font-size:11px;font-family:var(--sans);font-weight:500;cursor:pointer}
.alc-cat.active{border-color:var(--alc);background:var(--alcd);color:var(--alc)}
.alc-select{width:100%;background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--txt);font-family:var(--mono);font-size:11px;padding:8px 10px;outline:none;-webkit-appearance:none;margin-bottom:8px;cursor:pointer}
.alc-qty{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.alc-qty-lbl{font-family:var(--mono);font-size:10px;color:var(--muted);flex-shrink:0}
.alc-qty-btns{display:flex;align-items:center;gap:8px}
.aqbtn{background:var(--sur2);border:1px solid var(--bd);border-radius:4px;color:var(--txt);font-family:var(--mono);font-size:16px;width:30px;height:30px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.aqbtn:active{border-color:var(--alc)}
.alc-qty-val{font-family:var(--mono);font-size:14px;font-weight:600;min-width:20px;text-align:center}
.alc-preview{background:var(--sur2);border:1px solid var(--bd);border-radius:var(--rs);padding:8px 10px;margin-bottom:10px}
.alc-prev-nums{display:flex;gap:14px}
.apv{font-family:var(--mono);font-size:13px;font-weight:600}
.apv.c{color:var(--cal)}.apv.p{color:var(--prot)}.apv.f{color:var(--fat)}
.apl{font-family:var(--mono);font-size:8px;color:var(--muted);margin-top:1px}
.dots{display:inline-flex;gap:3px;align-items:center}
.dots span{width:4px;height:4px;border-radius:50%;background:var(--cal);animation:dp 1.2s infinite}
.dots span:nth-child(2){animation-delay:.2s}.dots span:nth-child(3){animation-delay:.4s}
@keyframes dp{0%,60%,100%{opacity:.3;transform:scale(.8)}30%{opacity:1;transform:scale(1)}}
.empty{text-align:center;padding:22px 10px;color:var(--dim);font-family:var(--mono);font-size:10px}
.ei{font-size:20px;margin-bottom:5px;opacity:.3}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--sur2);border:1px solid var(--bd2);border-radius:var(--rs);padding:7px 14px;font-family:var(--mono);font-size:10px;color:var(--txt);z-index:200;transition:opacity .3s;opacity:0;pointer-events:none;max-width:90vw;text-align:center}
.toast.on{opacity:1}
</style>
</head>
<body>
<div class="app">
  <div class="hdr">
    <div class="logo">fuel</div>
    <div class="sync-dot" id="sync-dot"></div>
  </div>
  <div class="date-nav">
    <button class="dnav-btn" onclick="shiftDate(-1)">&#8249;</button>
    <div class="dnav-mid">
      <div class="dnav-label" id="dnav-label">Today</div>
      <div class="dnav-sub" id="dnav-sub"></div>
    </div>
    <div class="dnav-right">
      <button class="dnav-today" id="dnav-today" onclick="goToday()">Today</button>
      <button class="dnav-btn" id="dnav-next" onclick="shiftDate(1)">&#8250;</button>
    </div>
  </div>
  <div class="big-bars">
    <div class="big-bar cal">
      <div class="bb-top">
        <div><div class="bb-lbl">Calories</div><div class="bb-nums"><div class="bb-val" id="v-cal">0</div><div class="bb-tgt">/ 2,100</div></div></div>
        <div class="bb-pct" id="p-cal">0%</div>
      </div>
      <div class="btrack"><div class="bfill" id="b-cal" style="width:0%"></div></div>
    </div>
    <div class="big-bar prot">
      <div class="bb-top">
        <div><div class="bb-lbl">Protein</div><div class="bb-nums"><div class="bb-val" id="v-prot">0g</div><div class="bb-tgt">/ 150g</div></div></div>
        <div class="bb-pct" id="p-prot">0%</div>
      </div>
      <div class="btrack"><div class="bfill" id="b-prot" style="width:0%"></div></div>
    </div>
  </div>
  <div class="mini-grid">
    <div class="mc2 fat"><div class="mc2-lbl">Fat</div><div class="mc2-val" id="v-fat">0g</div><div class="mc2-sub" id="p-fat">0% of 70g</div><div class="mtrack"><div class="mfill" id="b-fat" style="width:0%"></div></div></div>
    <div class="mc2 fiber"><div class="mc2-lbl">Fiber</div><div class="mc2-val" id="v-fiber">0g</div><div class="mc2-sub" id="p-fiber">0% of 35g</div><div class="mtrack"><div class="mfill" id="b-fiber" style="width:0%"></div></div></div>
    <div class="mc2 water"><div class="mc2-lbl">Water</div><div class="mc2-val" id="v-water">0</div><div class="mc2-sub" id="p-water">0 of 8</div><div class="mtrack"><div class="mfill" id="b-water" style="width:0%"></div></div><div class="wbtns"><button class="wbtn" onclick="addWater(1)">+1</button><button class="wbtn" onclick="addWater(-1)">-1</button></div></div>
  </div>
  <div class="status-row">
    <div class="sbadge"><div class="sdot" id="sdot"></div><span class="slbl">status&nbsp;</span><span class="sval" id="stext">&#8212;</span></div>
    <div class="sbadge" style="flex:0;white-space:nowrap"><span class="slbl">deficit&nbsp;</span><span class="sval" id="wdef" style="color:var(--fiber)">&#8212;</span></div>
  </div>
  <div class="assess" id="assessment">
    <div class="assess-top"><div class="assess-icon" id="a-icon"></div><div class="assess-stat" id="a-status"></div></div>
    <div class="assess-note" id="a-note"></div>
  </div>
  <div class="sec">Quick Add</div>
  <div class="quick-row">
    <button class="qbtn" onclick="quickPreset('coffee')">&#9749; Iced Coffee</button>
    <button class="qbtn" onclick="quickPreset('smoothie')">&#127946; Smoothie</button>
  </div>
  <div class="sec">Log a Meal</div>
  <div class="log-panel">
    <div class="log-tabs">
      <button class="ltab active" onclick="switchTab('text',this)">&#9998; describe</button>
      <button class="ltab" onclick="switchTab('photo',this)">&#128247; photo</button>
      <button class="ltab" onclick="switchTab('voice',this)">&#127897; voice</button>
      <button class="ltab" onclick="switchTab('history',this)">&#9889; recent</button>
    </div>
    <div class="lpane active" id="pane-text">
      <div class="chips">
        <button class="chip active" onclick="setType('breakfast',this)">Breakfast</button>
        <button class="chip" onclick="setType('lunch',this)">Lunch</button>
        <button class="chip" onclick="setType('dinner',this)">Dinner</button>
        <button class="chip" onclick="setType('snack',this)">Snack</button>
        <button class="chip drink-chip" onclick="openDrinkModal()">&#127863; Drink</button>
      </div>
      <div class="iw">
        <textarea class="ti" id="t-input" placeholder="e.g. HomeChef chicken tikka masala, 2/3 portion. Subbed kielbasa."></textarea>
        <textarea class="ni" id="t-notes" placeholder="Notes (optional)..."></textarea>
      </div>
      <div class="la"><span class="hint">mention portion &amp; mods</span><button class="btn-az" id="btn-text" onclick="analyzeText()">Analyze &#8594;</button></div>
    </div>
    <div class="lpane" id="pane-photo">
      <div class="chips">
        <button class="chip active" onclick="setType('breakfast',this)">Breakfast</button>
        <button class="chip" onclick="setType('lunch',this)">Lunch</button>
        <button class="chip" onclick="setType('dinner',this)">Dinner</button>
        <button class="chip" onclick="setType('snack',this)">Snack</button>
      </div>
      <div class="iw">
        <div class="pdrop"><input type="file" accept="image/*" id="p-input" onchange="handlePhoto(event)"><div style="font-size:22px">&#128248;</div><p>Tap to upload photo</p><small>JPEG &middot; PNG &middot; HEIC</small></div>
        <div class="pprev" id="pprev"><img id="pimg" src="" alt=""></div>
        <textarea class="ni" id="p-notes" placeholder="Context... e.g. HomeChef meal name, ate 3/4"></textarea>
      </div>
      <div class="la"><span class="hint" id="pname">No photo</span><button class="btn-az" id="btn-photo" onclick="analyzePhoto()" disabled>Analyze &#8594;</button></div>
    </div>
    <div class="lpane" id="pane-voice">
      <div class="chips">
        <button class="chip active" onclick="setType('breakfast',this)">Breakfast</button>
        <button class="chip" onclick="setType('lunch',this)">Lunch</button>
        <button class="chip" onclick="setType('dinner',this)">Dinner</button>
        <button class="chip" onclick="setType('snack',this)">Snack</button>
      </div>
      <div class="vc"><button class="vbtn" id="vbtn" onclick="toggleVoice()">&#127897;</button><div class="vstatus" id="vstatus">Tap to speak</div></div>
      <div class="vtx" id="vtx"></div>
      <div class="la"><span class="hint">speak naturally</span><button class="btn-az" id="btn-voice" onclick="analyzeVoice()" disabled>Analyze &#8594;</button></div>
    </div>
    <div class="lpane" id="pane-history">
      <div class="hl" id="hist-list"><div class="empty"><div class="ei">&#9889;</div>No history yet.</div></div>
    </div>
  </div>
  <div class="air" id="air">
    <div class="air-hdr">
      <div class="air-ttl">AI Estimate <span class="aichip">CLAUDE</span></div>
      <span id="ai-dots" style="display:none" class="dots"><span></span><span></span><span></span></span>
    </div>
    <div class="air-nums">
      <div><div class="anv c" id="ai-cal">&#8212;</div><div class="anl">kcal</div></div>
      <div><div class="anv p" id="ai-prot">&#8212;</div><div class="anl">protein</div></div>
      <div><div class="anv f" id="ai-fat">&#8212;</div><div class="anl">fat</div></div>
      <div><div class="anv fi" id="ai-fiber">&#8212;</div><div class="anl">fiber</div></div>
    </div>
    <div class="air-desc" id="ai-desc"></div>
    <div class="egrid">
      <div class="ef"><label>Calories</label><input type="number" id="e-cal" inputmode="numeric"></div>
      <div class="ef"><label>Protein (g)</label><input type="number" id="e-prot" inputmode="numeric"></div>
      <div class="ef"><label>Fat (g)</label><input type="number" id="e-fat" inputmode="numeric"></div>
      <div class="ef"><label>Fiber (g)</label><input type="number" id="e-fiber" inputmode="numeric"></div>
    </div>
    <div class="air-acts">
      <button class="btn-ok" onclick="confirmEntry()">Add to Log &#10003;</button>
      <button class="btn-no" onclick="discardEntry()">&#10005;</button>
    </div>
  </div>
  <div class="sec">Planning Tools</div>
  <div class="plan-box">
    <div class="plan-tabs">
      <button class="ptab active" onclick="switchPlan('dinner',this)">&#127869; Dinner Ideas</button>
      <button class="ptab" onclick="switchPlan('restaurant',this)">&#128205; Restaurant</button>
      <button class="ptab" onclick="switchPlan('h2h',this)">&#9876; Compare</button>
    </div>
    <div class="ppane active" id="plan-dinner">
      <div class="dinner-hdr"><div class="dinner-sub">Based on today's intake</div><button class="btn-dinner" id="btn-dinner" onclick="getDinnerRecs()">Get ideas &#8594;</button></div>
      <div class="dinner-cards" id="dinner-cards"><div class="empty"><div class="ei">&#127869;</div>Log some meals first.</div></div>
    </div>
    <div class="ppane" id="plan-restaurant">
      <div class="rest-panel">
        <div class="rest-row">
          <input class="rest-input" id="rest-name" type="text" placeholder="Restaurant name... e.g. Milos NYC">
          <button class="btn-rest" id="btn-rest" onclick="getRestaurantRecs()">Optimize &#8594;</button>
        </div>
        <button class="rest-toggle" id="rest-toggle" onclick="toggleMenuPaste()">+ paste menu (optional)</button>
        <textarea class="rest-menu" id="rest-menu" placeholder="Paste menu items here for more accurate recommendations..."></textarea>
        <div class="rest-courses">
          <span class="rcl">Courses:</span>
          <button class="rcbtn active" onclick="toggleCourse('appetizer',this)">Appetizer</button>
          <button class="rcbtn active" onclick="toggleCourse('main',this)">Main</button>
          <button class="rcbtn" onclick="toggleCourse('dessert',this)">Dessert</button>
        </div>
        <div class="rest-results" id="rest-results"><div class="empty"><div class="ei">&#128205;</div>Enter a restaurant to get macro-optimized suggestions.</div></div>
      </div>
    </div>
    <div class="ppane" id="plan-h2h">
      <div class="h2h-inputs">
        <div class="h2h-slot">
          <div class="h2h-lbl">Option A</div>
          <div class="h2h-type-row">
            <button class="h2h-type active" onclick="setH2HType('a','text',this)">Text</button>
            <button class="h2h-type" onclick="setH2HType('a','photo',this)">Photo</button>
          </div>
          <div id="h2h-a-text-wrap"><textarea class="h2h-txt" id="h2h-a-text" placeholder="Describe meal A..."></textarea></div>
          <div id="h2h-a-photo-wrap" style="display:none"><div class="h2h-img-drop"><input type="file" accept="image/*" onchange="handleH2HPhoto(event,'a')"><div>&#128247;</div><p>tap to upload</p></div><div class="h2h-img-prev" id="h2h-a-prev"><img id="h2h-a-img" src="" alt=""></div></div>
        </div>
        <div class="h2h-slot">
          <div class="h2h-lbl">Option B</div>
          <div class="h2h-type-row">
            <button class="h2h-type active" onclick="setH2HType('b','text',this)">Text</button>
            <button class="h2h-type" onclick="setH2HType('b','photo',this)">Photo</button>
          </div>
          <div id="h2h-b-text-wrap"><textarea class="h2h-txt" id="h2h-b-text" placeholder="Describe meal B..."></textarea></div>
          <div id="h2h-b-photo-wrap" style="display:none"><div class="h2h-img-drop"><input type="file" accept="image/*" onchange="handleH2HPhoto(event,'b')"><div>&#128247;</div><p>tap to upload</p></div><div class="h2h-img-prev" id="h2h-b-prev"><img id="h2h-b-img" src="" alt=""></div></div>
        </div>
      </div>
      <button class="btn-h2h" onclick="runH2H()">Compare &#8594;</button>
      <div class="h2h-result" id="h2h-result"><div class="h2h-winner" id="h2h-winner"></div><div class="h2h-compare" id="h2h-compare"></div><div class="h2h-reasoning" id="h2h-reasoning"></div></div>
    </div>
  </div>
  <div class="sec" id="log-label">Today's Log</div>
  <div class="meals" id="meals-list"><div class="empty"><div class="ei">&#127869;</div>No meals yet.</div></div>
  <div class="wp">
    <div class="wp-hdr"><div class="wp-title">This Week</div><div class="wp-stats"><div class="wst">Avg <span id="wavg">&#8212;</span></div><div class="wst">Days <span id="wdays">0</span>/7</div></div></div>
    <div class="wbars" id="wbars"></div>
  </div>
  <div class="sumbox">
    <div class="sumlbl">Daily Summary <span class="aichip">CLAUDE</span></div>
    <div class="sumtxt" id="sum-text">Tap below to get your daily performance analysis.</div>
    <button class="btn-gen" id="sum-btn" onclick="getDailySummary()">Generate summary &#8594;</button>
  </div>
</div>

<div class="overlay" id="drink-overlay">
  <div class="modal">
    <div class="modal-title">Log a Drink</div>
    <div class="alc-row" id="alc-cats">
      <button class="alc-cat active" onclick="setAlcCat('beer',this)">&#127866; Beer</button>
      <button class="alc-cat" onclick="setAlcCat('tequila',this)">&#129347; Tequila</button>
      <button class="alc-cat" onclick="setAlcCat('wine',this)">&#127863; Wine</button>
      <button class="alc-cat" onclick="setAlcCat('negroni',this)">&#127864; Negroni</button>
      <button class="alc-cat" onclick="setAlcCat('boul',this)">Boulevardier</button>
    </div>
    <select class="alc-select" id="alc-select" onchange="updateAlcPreview()"></select>
    <div class="alc-qty"><span class="alc-qty-lbl">Qty:</span><div class="alc-qty-btns"><button class="aqbtn" onclick="changeAlcQty(-1)">&#8722;</button><span class="alc-qty-val" id="alc-qty">1</span><button class="aqbtn" onclick="changeAlcQty(1)">+</button></div></div>
    <div class="alc-preview" id="alc-preview"><div class="alc-prev-nums"><div><div class="apv c" id="alc-cal">&#8212;</div><div class="apl">kcal</div></div><div><div class="apv p" id="alc-carb">&#8212;</div><div class="apl">carbs</div></div><div><div class="apv f" id="alc-fat2">&#8212;</div><div class="apl">fat</div></div></div></div>
    <div class="macts"><button class="btn-sv" style="background:var(--alc)" onclick="addAlcohol()">Add to Log</button><button class="btn-cn" onclick="closeDrinkModal()">Cancel</button></div>
  </div>
</div>

<div class="overlay" id="edit-overlay">
  <div class="modal">
    <div class="modal-title">Edit Entry</div>
    <div class="mgrid">
      <div class="mf"><label>Calories</label><input type="number" id="m-cal" inputmode="numeric"></div>
      <div class="mf"><label>Protein (g)</label><input type="number" id="m-prot" inputmode="numeric"></div>
      <div class="mf"><label>Fat (g)</label><input type="number" id="m-fat" inputmode="numeric"></div>
      <div class="mf"><label>Fiber (g)</label><input type="number" id="m-fiber" inputmode="numeric"></div>
      <div class="mf"><label>Description</label><textarea id="m-desc"></textarea></div>
    </div>
    <div class="macts"><button class="btn-sv" onclick="saveEdit()">Save Changes</button><button class="btn-cn" onclick="closeEditModal()">Cancel</button></div>
  </div>
</div>
<div class="toast" id="toast"></div>
<script>
const PROXY='https://fuel-proxy.joshh031.workers.dev';
const SB_URL='https://vphqjxjphdsdpqaxqkpf.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZwaHFqeGpwaGRzZHBxYXhxa3BmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4ODE3NDIsImV4cCI6MjA4NzQ1Nzc0Mn0.FqKeUq05RihLNXVIpzvyTEAPmiSXZfYXGgTRCc0uYpE';
const T={cal:2100,prot:150,fat:70,fiber:35,water:8};
const SDAYS=['Su','Mo','Tu','We','Th','Fr','Sa'];

const PRESETS={
coffee:{desc:‚ÄòStarbucks Trenta Iced Coffee, splash whole milk‚Äô,type:‚Äòsnack‚Äô,cal:80,prot:2,fat:2,fiber:0,notes:‚Äô‚Äô},
smoothie:{desc:‚ÄòMorning smoothie: peanut butter, banana, Dymatize protein scoop, water, 5g creatine‚Äô,type:‚Äòbreakfast‚Äô,cal:420,prot:42,fat:12,fiber:4,notes:‚Äô‚Äô}
};

const ALC={
beer:[{name:‚ÄòBud Light (12oz)‚Äô,cal:110,carb:6.6,fat:0},{name:‚ÄòCoors Light (12oz)‚Äô,cal:102,carb:5,fat:0},{name:‚ÄòMiller Lite (12oz)‚Äô,cal:96,carb:3.2,fat:0},{name:‚ÄòCorona Extra (12oz)‚Äô,cal:148,carb:14,fat:0},{name:‚ÄòHeineken (12oz)‚Äô,cal:142,carb:11.4,fat:0},{name:‚ÄòModelo Especial (12oz)‚Äô,cal:143,carb:13.6,fat:0},{name:‚ÄòIPA craft (12oz)‚Äô,cal:200,carb:15,fat:0},{name:‚ÄòGuinness Draught (16oz)‚Äô,cal:166,carb:18,fat:0}],
tequila:[{name:‚ÄòTequila shot (1.5oz)‚Äô,cal:97,carb:0,fat:0},{name:‚ÄòTequila on rocks (2oz)‚Äô,cal:128,carb:0,fat:0},{name:‚ÄòMargarita (8oz)‚Äô,cal:280,carb:25,fat:0},{name:‚ÄòPaloma (8oz)‚Äô,cal:190,carb:18,fat:0},{name:‚ÄúTommy‚Äôs Margarita (8oz)‚Äù,cal:200,carb:16,fat:0}],
wine:[{name:‚ÄòWhite wine (5oz)‚Äô,cal:121,carb:3.8,fat:0},{name:‚ÄòSauvignon Blanc (5oz)‚Äô,cal:119,carb:3,fat:0},{name:‚ÄòPinot Grigio (5oz)‚Äô,cal:122,carb:3,fat:0},{name:‚ÄòChardonnay (5oz)‚Äô,cal:123,carb:3.7,fat:0},{name:‚ÄòMoscato (5oz)‚Äô,cal:127,carb:11,fat:0},{name:‚ÄòProsecco (5oz)‚Äô,cal:98,carb:2.5,fat:0}],
negroni:[{name:‚ÄòClassic Negroni (3oz)‚Äô,cal:210,carb:6,fat:0},{name:‚ÄòNegroni Sbagliato (4oz)‚Äô,cal:165,carb:8,fat:0},{name:‚ÄòMezcal Negroni (3oz)‚Äô,cal:210,carb:6,fat:0},{name:‚ÄòWhite Negroni (3oz)‚Äô,cal:195,carb:7,fat:0}],
boul:[{name:‚ÄòBoulevardier (3oz)‚Äô,cal:220,carb:7,fat:0},{name:‚ÄòBoulevardier on rocks (4oz)‚Äô,cal:230,carb:7,fat:0},{name:‚ÄòMezcal Boulevardier (3oz)‚Äô,cal:215,carb:7,fat:0}]
};

let S={meals:[],water:0,pending:null,editId:null,mealType:‚Äòbreakfast‚Äô,photoData:null,voiceRec:null,isRec:false,voiceTxt:‚Äô‚Äô,weekData:{},alcCat:‚Äòbeer‚Äô,alcQty:1,h2hType:{a:‚Äòtext‚Äô,b:‚Äòtext‚Äô},h2hPhotoA:null,h2hPhotoB:null,activeDate:null};
const SC={appetizer:true,main:true,dessert:false};

const td=()=>{const d=new Date();return d.getFullYear()+‚Äô-‚Äô+String(d.getMonth()+1).padStart(2,‚Äò0‚Äô)+‚Äô-‚Äô+String(d.getDate()).padStart(2,‚Äò0‚Äô);};
const isToday=()=>S.activeDate===td();

const sb={
async get(t,f){const r=await fetch(`${SB_URL}/rest/v1/${t}?${f}&order=created_at.asc`,{headers:{‚Äòapikey‚Äô:SB_KEY,‚ÄòAuthorization‚Äô:‚ÄôBearer ‚Äô+SB_KEY}});return r.json();},
async insert(t,d){const r=await fetch(`${SB_URL}/rest/v1/${t}`,{method:‚ÄòPOST‚Äô,headers:{‚Äòapikey‚Äô:SB_KEY,‚ÄòAuthorization‚Äô:‚ÄôBearer ‚Äô+SB_KEY,‚ÄòContent-Type‚Äô:‚Äòapplication/json‚Äô,‚ÄòPrefer‚Äô:‚Äòreturn=representation‚Äô},body:JSON.stringify(d)});return r.json();},
async update(t,f,d){const r=await fetch(`${SB_URL}/rest/v1/${t}?${f}`,{method:‚ÄòPATCH‚Äô,headers:{‚Äòapikey‚Äô:SB_KEY,‚ÄòAuthorization‚Äô:‚ÄôBearer ‚Äô+SB_KEY,‚ÄòContent-Type‚Äô:‚Äòapplication/json‚Äô,‚ÄòPrefer‚Äô:‚Äòreturn=representation‚Äô},body:JSON.stringify(d)});return r.json();},
async del(t,f){await fetch(`${SB_URL}/rest/v1/${t}?${f}`,{method:‚ÄòDELETE‚Äô,headers:{‚Äòapikey‚Äô:SB_KEY,‚ÄòAuthorization‚Äô:‚ÄôBearer ‚Äô+SB_KEY}});},
async upsert(t,d){const r=await fetch(`${SB_URL}/rest/v1/${t}`,{method:‚ÄòPOST‚Äô,headers:{‚Äòapikey‚Äô:SB_KEY,‚ÄòAuthorization‚Äô:‚ÄôBearer ‚Äô+SB_KEY,‚ÄòContent-Type‚Äô:‚Äòapplication/json‚Äô,‚ÄòPrefer‚Äô:‚Äòresolution=merge-duplicates,return=representation‚Äô},body:JSON.stringify(d)});return r.json();}
};

function setSyncStatus(s){const d=document.getElementById(‚Äòsync-dot‚Äô);d.className=‚Äòsync-dot‚Äô+(s===‚Äòok‚Äô?‚Äô ok‚Äô:s===‚Äòerr‚Äô?‚Äô err‚Äô:‚Äô‚Äô);}

function initDateNav(){S.activeDate=td();renderDateNav();}
function renderDateNav(){
const d=new Date(S.activeDate+‚ÄòT12:00:00‚Äô);
const today=td();
const isT=S.activeDate===today;
const y=new Date();y.setDate(y.getDate()-1);const yStr=y.toISOString().split(‚ÄòT‚Äô)[0];
let label=isT?‚ÄòToday‚Äô:S.activeDate===yStr?‚ÄòYesterday‚Äô:d.toLocaleDateString(‚Äòen-US‚Äô,{weekday:‚Äòlong‚Äô});
let sub=d.toLocaleDateString(‚Äòen-US‚Äô,{month:‚Äòshort‚Äô,day:‚Äònumeric‚Äô,year:‚Äònumeric‚Äô});
document.getElementById(‚Äòdnav-label‚Äô).textContent=label;
document.getElementById(‚Äòdnav-sub‚Äô).textContent=sub;
document.getElementById(‚Äòdnav-next‚Äô).disabled=isT;
const tb=document.getElementById(‚Äòdnav-today‚Äô);
tb.className=‚Äòdnav-today‚Äô+(isT?‚Äô‚Äô:‚Äô on‚Äô);
document.getElementById(‚Äòlog-label‚Äô).textContent=isT?‚ÄúToday‚Äôs Log‚Äù:label+‚Äù‚Äôs Log‚Äù;
}
function shiftDate(n){
const d=new Date(S.activeDate+‚ÄòT12:00:00‚Äô);d.setDate(d.getDate()+n);
const nd=d.toISOString().split(‚ÄòT‚Äô)[0];
if(nd>td())return;
S.activeDate=nd;renderDateNav();loadDay();
}
function goToday(){S.activeDate=td();renderDateNav();loadDay();}

async function loadDay(){
setSyncStatus(‚Äô‚Äô);S.meals=[];S.water=0;
try{
const meals=await sb.get(‚Äòmeals‚Äô,`date=eq.${S.activeDate}`);
if(Array.isArray(meals)){S.meals=meals.map(m=>({id:m.id,type:m.meal_type,desc:m.description,notes:m.notes||‚Äô‚Äô,cal:m.cal,prot:m.prot,fat:m.fat,fiber:m.fiber,time:m.meal_time}));}
const water=await sb.get(‚Äòwater_log‚Äô,`date=eq.${S.activeDate}`);
S.water=(Array.isArray(water)&&water.length>0)?water[0].cups:0;
if(isToday())await loadWeek();
setSyncStatus(‚Äòok‚Äô);
}catch(e){setSyncStatus(‚Äòerr‚Äô);}
updateDash();renderMeals();
if(isToday())renderWeek();
}

async function loadWeek(){
S.weekData={};
for(let i=6;i>=0;i‚Äì){
const d=new Date();d.setDate(d.getDate()-i);const s=d.toISOString().split(‚ÄòT‚Äô)[0];
try{const meals=await sb.get(‚Äòmeals‚Äô,`date=eq.${s}`);if(Array.isArray(meals)&&meals.length>0){S.weekData[s]={cal:meals.reduce((a,m)=>a+(m.cal||0),0),prot:meals.reduce((a,m)=>a+(m.prot||0),0),fat:meals.reduce((a,m)=>a+(m.fat||0),0),fiber:meals.reduce((a,m)=>a+(m.fiber||0),0)};}}catch(e){}
}
}

function totals(){return{cal:S.meals.reduce((a,m)=>a+(m.cal||0),0),prot:S.meals.reduce((a,m)=>a+(m.prot||0),0),fat:S.meals.reduce((a,m)=>a+(m.fat||0),0),fiber:S.meals.reduce((a,m)=>a+(m.fiber||0),0)};}

function updateDash(){
const t=totals();
const pct=(v,max)=>Math.min(100,Math.round(v/max*100));
document.getElementById(‚Äòv-cal‚Äô).textContent=t.cal.toLocaleString();
document.getElementById(‚Äòp-cal‚Äô).textContent=pct(t.cal,T.cal)+‚Äô%‚Äô;
document.getElementById(‚Äòb-cal‚Äô).style.width=pct(t.cal,T.cal)+‚Äô%‚Äô;
document.getElementById(‚Äòv-prot‚Äô).textContent=t.prot+‚Äòg‚Äô;
document.getElementById(‚Äòp-prot‚Äô).textContent=pct(t.prot,T.prot)+‚Äô%‚Äô;
document.getElementById(‚Äòb-prot‚Äô).style.width=pct(t.prot,T.prot)+‚Äô%‚Äô;
document.getElementById(‚Äòv-fat‚Äô).textContent=t.fat+‚Äòg‚Äô;
document.getElementById(‚Äòp-fat‚Äô).textContent=pct(t.fat,T.fat)+‚Äô% of 70g‚Äô;
document.getElementById(‚Äòb-fat‚Äô).style.width=pct(t.fat,T.fat)+‚Äô%‚Äô;
document.getElementById(‚Äòv-fiber‚Äô).textContent=t.fiber+‚Äòg‚Äô;
document.getElementById(‚Äòp-fiber‚Äô).textContent=pct(t.fiber,T.fiber)+‚Äô% of 35g‚Äô;
document.getElementById(‚Äòb-fiber‚Äô).style.width=pct(t.fiber,T.fiber)+‚Äô%‚Äô;
document.getElementById(‚Äòv-water‚Äô).textContent=S.water;
document.getElementById(‚Äòp-water‚Äô).textContent=S.water+‚Äô of 8‚Äô;
document.getElementById(‚Äòb-water‚Äô).style.width=pct(S.water,T.water)+‚Äô%‚Äô;
const rem=T.cal-t.cal;
const deficit=rem>0?‚Äô+‚Äô+rem.toLocaleString():rem.toLocaleString();
document.getElementById(‚Äòwdef‚Äô).textContent=deficit+‚Äô kcal‚Äô;
let status,dot,icon,astat,anote;
if(t.cal>=T.cal+200){status=‚Äòover‚Äô;dot=‚Äô#f55‚Äô;}
else if(t.cal>=T.cal-300&&t.prot>=T.prot*0.9){status=‚Äòon track‚Äô;dot=‚Äô#2ee89a‚Äô;}
else if(t.prot<T.prot*0.6&&t.cal>500){status=‚Äòprotein low‚Äô;dot=‚Äô#f5864a‚Äô;}
else{status=‚Äòdeficit‚Äô;dot=‚Äô#5b6fff‚Äô;}
document.getElementById(‚Äòstext‚Äô).textContent=status;
document.getElementById(‚Äòsdot‚Äô).style.background=dot;
const a=document.getElementById(‚Äòassessment‚Äô);
if(t.cal>0){
a.classList.add(‚Äòon‚Äô);
if(status===‚Äòover‚Äô){icon=‚Äò‚ö†Ô∏è‚Äô;astat=‚ÄòOver target‚Äô;anote=`${t.cal-T.cal} kcal over. Protein at ${t.prot}g.`;}
else if(status===‚Äòon track‚Äô){icon=‚Äò‚úÖ‚Äô;astat=‚ÄòOn track‚Äô;anote=`${rem} kcal remaining. Great protein at ${t.prot}g.`;}
else if(status===‚Äòprotein low‚Äô){icon=‚Äò‚ö†Ô∏è‚Äô;astat=‚ÄòDeficit ‚Äî protein light‚Äô;anote=`${Math.abs(rem)} kcal deficit. Protein at ${t.prot}g ‚Äî below threshold.`;}
else{icon=‚Äòüí™‚Äô;astat=‚ÄòDeficit ‚Äî on track‚Äô;anote=`${Math.abs(rem)} kcal deficit. Protein at ${t.prot}g.`;}
document.getElementById(‚Äòa-icon‚Äô).textContent=icon;
document.getElementById(‚Äòa-status‚Äô).textContent=astat;
document.getElementById(‚Äòa-note‚Äô).textContent=anote;
} else {a.classList.remove(‚Äòon‚Äô);}
if(isToday()&&S.weekData){S.weekData[S.activeDate]={cal:t.cal,prot:t.prot,fat:t.fat,fiber:t.fiber};}
}

function renderMeals(){
const el=document.getElementById(‚Äòmeals-list‚Äô);
if(!S.meals.length){el.innerHTML=‚Äô<div class="empty"><div class="ei">üçΩ</div>No meals yet.</div>‚Äô;return;}
el.innerHTML=[‚Ä¶S.meals].reverse().map(m=>` <div class="mcard"> <div class="mcard-top"> <span class="mbadge ${m.type}">${m.type}</span> <div class="mcard-body"> <div class="mcard-desc">${esc(m.desc)}</div> ${m.notes?`<div class="mcard-note">${esc(m.notes)}</div>`:''} <div class="mcard-time">${m.time||''}</div> </div> <div class="mcard-acts"> <button class="mab" onclick="openEditModal(${m.id})" title="Edit">‚úèÔ∏è</button> <button class="mab del" onclick="deleteMeal(${m.id})" title="Delete">‚úï</button> </div> </div> <div class="mcard-macros"> <div class="mm cal"><div class="mmv">${m.cal}</div><div class="mml">kcal</div></div> <div class="mm prot"><div class="mmv">${m.prot}g</div><div class="mml">prot</div></div> <div class="mm fat"><div class="mmv">${m.fat}g</div><div class="mml">fat</div></div> <div class="mm fiber"><div class="mmv">${m.fiber}g</div><div class="mml">fiber</div></div> </div> </div> `).join(‚Äô‚Äô);
}

function renderWeek(){
const bars=document.getElementById(‚Äòwbars‚Äô);
const now=new Date();
const days=[];
for(let i=6;i>=0;i‚Äì){const d=new Date(now);d.setDate(now.getDate()-i);const s=d.toISOString().split(‚ÄòT‚Äô)[0];days.push({s,label:SDAYS[d.getDay()],isToday:s===td()});}
const maxCal=Math.max(T.cal*1.1,‚Ä¶days.map(d=>S.weekData[d.s]?.cal||0));
let totCal=0,logDays=0;
bars.innerHTML=days.map(day=>{
const cal=S.weekData[day.s]?.cal||0;const pct=cal>0?Math.round(cal/maxCal*100):0;
if(cal>0){totCal+=cal;logDays++;}
let cls=‚Äòlow‚Äô;if(day.isToday)cls=‚Äòtoday‚Äô;else if(cal>T.cal+100)cls=‚Äòover‚Äô;else if(cal>=T.cal-300)cls=‚Äògood‚Äô;
return`<div class="wd${day.isToday?' cur':''}"><div class="wbw"><div class="wb ${cls}" style="height:${pct}%"></div></div><div class="wlbl">${day.label}</div></div>`;
}).join(‚Äô‚Äô);
document.getElementById(‚Äòwavg‚Äô).textContent=logDays>0?Math.round(totCal/logDays).toLocaleString():‚Äô‚Äî‚Äô;
document.getElementById(‚Äòwdays‚Äô).textContent=logDays;
}

function init(){initDateNav();initAlcohol();loadDay();}

function switchTab(tab,btn){
document.querySelectorAll(‚Äô.ltab‚Äô).forEach(t=>t.classList.remove(‚Äòactive‚Äô));
document.querySelectorAll(‚Äô.lpane‚Äô).forEach(p=>p.classList.remove(‚Äòactive‚Äô));
btn.classList.add(‚Äòactive‚Äô);
document.getElementById(‚Äòpane-‚Äô+tab).classList.add(‚Äòactive‚Äô);
if(tab===‚Äòhistory‚Äô)renderHistory();
}
function switchPlan(tab,btn){
document.querySelectorAll(‚Äô.ptab‚Äô).forEach(t=>t.classList.remove(‚Äòactive‚Äô));
document.querySelectorAll(‚Äô.ppane‚Äô).forEach(p=>p.classList.remove(‚Äòactive‚Äô));
btn.classList.add(‚Äòactive‚Äô);
document.getElementById(‚Äòplan-‚Äô+tab).classList.add(‚Äòactive‚Äô);
}
function setType(type,btn){
S.mealType=type;
btn.closest(‚Äô.chips‚Äô).querySelectorAll(‚Äô.chip:not(.drink-chip)‚Äô).forEach(c=>c.classList.remove(‚Äòactive‚Äô));
btn.classList.add(‚Äòactive‚Äô);
}

async function addWater(n){
S.water=Math.max(0,Math.min(20,S.water+n));updateDash();
try{await sb.upsert(‚Äòwater_log‚Äô,{date:S.activeDate,cups:S.water});}catch(e){}
}

async function quickPreset(key){
const p=PRESETS[key];
const entry={id:Date.now(),type:p.type,desc:p.desc,notes:p.notes,cal:p.cal,prot:p.prot,fat:p.fat,fiber:p.fiber,time:new Date().toLocaleTimeString(‚Äòen-US‚Äô,{hour:‚Äò2-digit‚Äô,minute:‚Äò2-digit‚Äô})};
S.meals.push(entry);updateDash();renderMeals();showToast(entry.cal+‚Äô kcal added‚Äô);
try{await sb.insert(‚Äòmeals‚Äô,{id:entry.id,date:S.activeDate,meal_type:entry.type,description:entry.desc,notes:entry.notes,cal:entry.cal,prot:entry.prot,fat:entry.fat,fiber:entry.fiber,meal_time:entry.time});setSyncStatus(‚Äòok‚Äô);}catch(e){setSyncStatus(‚Äòerr‚Äô);}
}

function openDrinkModal(){document.getElementById(‚Äòdrink-overlay‚Äô).classList.add(‚Äòon‚Äô);updateAlcPreview();}
function closeDrinkModal(){document.getElementById(‚Äòdrink-overlay‚Äô).classList.remove(‚Äòon‚Äô);}
document.getElementById(‚Äòdrink-overlay‚Äô).addEventListener(‚Äòclick‚Äô,function(e){if(e.target===this)closeDrinkModal();});

function initAlcohol(){setAlcCat(‚Äòbeer‚Äô,document.querySelector(‚Äô.alc-cat‚Äô));}
function setAlcCat(cat,btn){
S.alcCat=cat;
document.querySelectorAll(‚Äô.alc-cat‚Äô).forEach(b=>b.classList.remove(‚Äòactive‚Äô));btn.classList.add(‚Äòactive‚Äô);
const sel=document.getElementById(‚Äòalc-select‚Äô);
sel.innerHTML=ALC[cat].map((a,i)=>`<option value="${i}">${a.name}</option>`).join(‚Äô‚Äô);
updateAlcPreview();
}
function changeAlcQty(n){S.alcQty=Math.max(1,Math.min(10,S.alcQty+n));document.getElementById(‚Äòalc-qty‚Äô).textContent=S.alcQty;updateAlcPreview();}
function updateAlcPreview(){
const idx=parseInt(document.getElementById(‚Äòalc-select‚Äô).value)||0;
const item=ALC[S.alcCat][idx];if(!item)return;
const q=S.alcQty;
document.getElementById(‚Äòalc-cal‚Äô).textContent=Math.round(item.cal*q);
document.getElementById(‚Äòalc-carb‚Äô).textContent=Math.round(item.carb*q)+‚Äòg‚Äô;
document.getElementById(‚Äòalc-fat2‚Äô).textContent=Math.round(item.fat*q)+‚Äòg‚Äô;
}
async function addAlcohol(){
const idx=parseInt(document.getElementById(‚Äòalc-select‚Äô).value)||0;
const item=ALC[S.alcCat][idx];if(!item)return;
const q=S.alcQty;
const entry={id:Date.now(),type:‚Äòdrink‚Äô,desc:item.name+(q>1?‚Äô x‚Äô+q:‚Äô‚Äô),notes:‚Äô‚Äô,cal:Math.round(item.cal*q),prot:0,fat:Math.round(item.fat*q),fiber:0,time:new Date().toLocaleTimeString(‚Äòen-US‚Äô,{hour:‚Äò2-digit‚Äô,minute:‚Äò2-digit‚Äô})};
S.meals.push(entry);updateDash();renderMeals();closeDrinkModal();showToast(entry.cal+‚Äô kcal added‚Äô);
try{await sb.insert(‚Äòmeals‚Äô,{id:entry.id,date:S.activeDate,meal_type:entry.type,description:entry.desc,notes:‚Äô‚Äô,cal:entry.cal,prot:0,fat:entry.fat,fiber:0,meal_time:entry.time});setSyncStatus(‚Äòok‚Äô);}catch(e){setSyncStatus(‚Äòerr‚Äô);}
}

function handlePhoto(e){
const file=e.target.files[0];if(!file)return;
const r=new FileReader();
r.onload=ev=>{S.photoData=ev.target.result;document.getElementById(‚Äòpimg‚Äô).src=S.photoData;document.getElementById(‚Äòpprev‚Äô).style.display=‚Äòblock‚Äô;document.getElementById(‚Äòpname‚Äô).textContent=file.name;document.getElementById(‚Äòbtn-photo‚Äô).disabled=false;};
r.readAsDataURL(file);
}
function handleH2HPhoto(e,side){
const file=e.target.files[0];if(!file)return;
const r=new FileReader();
r.onload=ev=>{if(side===‚Äòa‚Äô){S.h2hPhotoA=ev.target.result;document.getElementById(‚Äòh2h-a-img‚Äô).src=S.h2hPhotoA;document.getElementById(‚Äòh2h-a-prev‚Äô).style.display=‚Äòblock‚Äô;}else{S.h2hPhotoB=ev.target.result;document.getElementById(‚Äòh2h-b-img‚Äô).src=S.h2hPhotoB;document.getElementById(‚Äòh2h-b-prev‚Äô).style.display=‚Äòblock‚Äô;}};
r.readAsDataURL(file);
}
function setH2HType(side,type,btn){
S.h2hType[side]=type;
btn.closest(‚Äô.h2h-type-row‚Äô).querySelectorAll(‚Äô.h2h-type‚Äô).forEach(b=>b.classList.remove(‚Äòactive‚Äô));btn.classList.add(‚Äòactive‚Äô);
document.getElementById(`h2h-${side}-text-wrap`).style.display=type===‚Äòtext‚Äô?‚Äòblock‚Äô:‚Äònone‚Äô;
document.getElementById(`h2h-${side}-photo-wrap`).style.display=type===‚Äòphoto‚Äô?‚Äòblock‚Äô:‚Äònone‚Äô;
}

function toggleVoice(){S.isRec?stopVoice():startVoice();}
function startVoice(){
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(!SR){showToast(‚ÄòSpeech not available in this browser‚Äô);return;}
const r=new SR();r.continuous=true;r.interimResults=true;S.voiceRec=r;S.isRec=true;
document.getElementById(‚Äòvbtn‚Äô).classList.add(‚Äòrec‚Äô);document.getElementById(‚Äòvbtn‚Äô).innerHTML=‚Äô‚èπ‚Äô;
document.getElementById(‚Äòvstatus‚Äô).textContent=‚ÄòListening‚Ä¶‚Äô;document.getElementById(‚Äòvtx‚Äô).style.display=‚Äòblock‚Äô;
r.onresult=e=>{let t=‚Äô‚Äô;for(let i=0;i<e.results.length;i++)t+=e.results[i][0].transcript;S.voiceTxt=t;document.getElementById(‚Äòvtx‚Äô).textContent=t;document.getElementById(‚Äòbtn-voice‚Äô).disabled=false;};
r.onerror=r.onend=()=>stopVoice();r.start();
}
function stopVoice(){
S.isRec=false;try{S.voiceRec?.stop();}catch(e){}
document.getElementById(‚Äòvbtn‚Äô).classList.remove(‚Äòrec‚Äô);document.getElementById(‚Äòvbtn‚Äô).innerHTML=‚Äôüéô‚Äô;
document.getElementById(‚Äòvstatus‚Äô).textContent=S.voiceTxt?‚ÄòTap to re-record‚Äô:‚ÄòTap to speak‚Äô;
}

const SYS=`You are a nutrition estimator. Targets: 2100 cal, 150g protein, 70g fat, 35g fiber. Respond ONLY with valid JSON, no markdown: {"calories":<int>,"protein":<int>,"fat":<int>,"fiber":<int>,"description":"<one concise sentence>"} Estimate conservatively but realistically. Recognize HomeChef meal kit names. For meal kits assume 600-900 cal per full serving, adjust for stated portion.`;

const SUMSY=`You are a performance nutrition analyst. User targets: 2100 cal, 150g protein, 70g fat, 35g fiber. Goal: fat loss with muscle preservation. Give a direct 2-3 sentence daily assessment covering deficit/surplus status, protein adequacy, and one specific recommendation. No fluff.`;

async function callAPI(messages,system){
const res=await fetch(PROXY,{method:‚ÄòPOST‚Äô,headers:{‚ÄòContent-Type‚Äô:‚Äòapplication/json‚Äô},body:JSON.stringify({model:‚Äòclaude-sonnet-4-20250514‚Äô,max_tokens:1500,system:system||SYS,messages})});
const data=await res.json();
if(!res.ok)throw new Error((data.error&&data.error.message)||‚ÄòHTTP ‚Äò+res.status);
if(data.error)throw new Error(data.error.message||‚ÄòAPI error‚Äô);
if(!data.content||!data.content[0])throw new Error(‚ÄòEmpty response‚Äô);
return data.content[0].text;
}
function parseJ(raw){return JSON.parse(raw.replace(/`json|`/g,‚Äô‚Äô).trim());}

async function analyzeText(){
const input=document.getElementById(‚Äòt-input‚Äô).value.trim();
if(!input){showToast(‚ÄòEnter a meal description first‚Äô);return;}
const notes=document.getElementById(‚Äòt-notes‚Äô).value.trim();
showAILoading();const btn=document.getElementById(‚Äòbtn-text‚Äô);btn.disabled=true;btn.textContent=‚Äô‚Ä¶‚Äô;
try{showAIResult(parseJ(await callAPI([{role:‚Äòuser‚Äô,content:`Meal type: ${S.mealType}\nDescription: ${input}${notes?'\nNotes: '+notes:''}`}])),input,S.mealType,notes);}
catch(e){showToast(‚ÄòFailed: ‚Äò+e.message.substring(0,60),5000);hideAI();}
btn.disabled=false;btn.textContent=‚ÄòAnalyze ‚Üí‚Äô;
}
async function analyzePhoto(){
if(!S.photoData)return;
showAILoading();const btn=document.getElementById(‚Äòbtn-photo‚Äô);btn.disabled=true;btn.textContent=‚Äô‚Ä¶‚Äô;
try{
const b64=S.photoData.split(‚Äô,‚Äô)[1];const mime=(S.photoData.match(/data:([^;]+);/)||[])[1]||‚Äòimage/jpeg‚Äô;
const notes=document.getElementById(‚Äòp-notes‚Äô).value.trim();
showAIResult(parseJ(await callAPI([{role:‚Äòuser‚Äô,content:[{type:‚Äòimage‚Äô,source:{type:‚Äòbase64‚Äô,media_type:mime,data:b64}},{type:‚Äòtext‚Äô,text:`Meal type: ${S.mealType}. ${notes||'Estimate macros from this meal photo.'}`}]}])),‚ÄòMeal from photo‚Äô,S.mealType,notes);
}catch(e){showToast(‚ÄòFailed: ‚Äò+e.message.substring(0,60),5000);hideAI();}
btn.disabled=false;btn.textContent=‚ÄòAnalyze ‚Üí‚Äô;
}
async function analyzeVoice(){
if(!S.voiceTxt)return;
showAILoading();const btn=document.getElementById(‚Äòbtn-voice‚Äô);btn.disabled=true;btn.textContent=‚Äô‚Ä¶‚Äô;
try{showAIResult(parseJ(await callAPI([{role:‚Äòuser‚Äô,content:`Meal type: ${S.mealType}\nDescription: ${S.voiceTxt}`}])),S.voiceTxt,S.mealType,‚Äô‚Äô);}
catch(e){showToast(‚ÄôFailed: ‚Äô+e.message.substring(0,60),5000);hideAI();}
btn.disabled=false;btn.textContent=‚ÄòAnalyze ‚Üí‚Äô;
}

function showAILoading(){document.getElementById(‚Äòair‚Äô).classList.add(‚Äòon‚Äô);document.getElementById(‚Äòai-dots‚Äô).style.display=‚Äòflex‚Äô;}
function hideAI(){document.getElementById(‚Äòair‚Äô).classList.remove(‚Äòon‚Äô);S.pending=null;}
function showAIResult(p,desc,type,notes){
document.getElementById(‚Äòai-dots‚Äô).style.display=‚Äònone‚Äô;
document.getElementById(‚Äòai-cal‚Äô).textContent=p.calories;
document.getElementById(‚Äòai-prot‚Äô).textContent=p.protein+‚Äòg‚Äô;
document.getElementById(‚Äòai-fat‚Äô).textContent=p.fat+‚Äòg‚Äô;
document.getElementById(‚Äòai-fiber‚Äô).textContent=p.fiber+‚Äòg‚Äô;
document.getElementById(‚Äòai-desc‚Äô).textContent=p.description||desc;
document.getElementById(‚Äòe-cal‚Äô).value=p.calories;
document.getElementById(‚Äòe-prot‚Äô).value=p.protein;
document.getElementById(‚Äòe-fat‚Äô).value=p.fat;
document.getElementById(‚Äòe-fiber‚Äô).value=p.fiber;
S.pending={type,desc,notes:notes||‚Äô‚Äô,cal:p.calories,prot:p.protein,fat:p.fat,fiber:p.fiber};
}
async function confirmEntry(){
if(!S.pending)return;
const entry={id:Date.now(),type:S.pending.type,desc:S.pending.desc,notes:S.pending.notes,cal:parseInt(document.getElementById(‚Äòe-cal‚Äô).value)||0,prot:parseInt(document.getElementById(‚Äòe-prot‚Äô).value)||0,fat:parseInt(document.getElementById(‚Äòe-fat‚Äô).value)||0,fiber:parseInt(document.getElementById(‚Äòe-fiber‚Äô).value)||0,time:new Date().toLocaleTimeString(‚Äòen-US‚Äô,{hour:‚Äò2-digit‚Äô,minute:‚Äò2-digit‚Äô})};
S.meals.push(entry);updateDash();renderMeals();hideAI();resetInputs();
showToast(entry.cal+‚Äô kcal ¬∑ ‚Äò+entry.prot+‚Äòg protein added‚Äô);
try{await sb.insert(‚Äòmeals‚Äô,{id:entry.id,date:S.activeDate,meal_type:entry.type,description:entry.desc,notes:entry.notes,cal:entry.cal,prot:entry.prot,fat:entry.fat,fiber:entry.fiber,meal_time:entry.time});setSyncStatus(‚Äòok‚Äô);}catch(e){setSyncStatus(‚Äòerr‚Äô);}
}
function discardEntry(){hideAI();}
function resetInputs(){
document.getElementById(‚Äòt-input‚Äô).value=‚Äô‚Äô;document.getElementById(‚Äòt-notes‚Äô).value=‚Äô‚Äô;
document.getElementById(‚Äòp-input‚Äô).value=‚Äô‚Äô;document.getElementById(‚Äòpprev‚Äô).style.display=‚Äònone‚Äô;
document.getElementById(‚Äòpname‚Äô).textContent=‚ÄòNo photo‚Äô;document.getElementById(‚Äòbtn-photo‚Äô).disabled=true;
document.getElementById(‚Äòp-notes‚Äô).value=‚Äô‚Äô;S.photoData=null;
document.getElementById(‚Äòvtx‚Äô).textContent=‚Äô‚Äô;document.getElementById(‚Äòvtx‚Äô).style.display=‚Äònone‚Äô;
S.voiceTxt=‚Äô‚Äô;document.getElementById(‚Äòbtn-voice‚Äô).disabled=true;
document.getElementById(‚Äòvstatus‚Äô).textContent=‚ÄòTap to speak‚Äô;
}

async function deleteMeal(id){
S.meals=S.meals.filter(m=>m.id!==id);updateDash();renderMeals();
try{await sb.del(‚Äòmeals‚Äô,`id=eq.${id}`);setSyncStatus(‚Äòok‚Äô);}catch(e){setSyncStatus(‚Äòerr‚Äô);}
}
function openEditModal(id){
const m=S.meals.find(m=>m.id===id);if(!m)return;S.editId=id;
document.getElementById(‚Äòm-cal‚Äô).value=m.cal;document.getElementById(‚Äòm-prot‚Äô).value=m.prot;
document.getElementById(‚Äòm-fat‚Äô).value=m.fat;document.getElementById(‚Äòm-fiber‚Äô).value=m.fiber;
document.getElementById(‚Äòm-desc‚Äô).value=m.desc;
document.getElementById(‚Äòedit-overlay‚Äô).classList.add(‚Äòon‚Äô);
}
async function saveEdit(){
const m=S.meals.find(m=>m.id===S.editId);if(!m)return;
m.cal=parseInt(document.getElementById(‚Äòm-cal‚Äô).value)||0;m.prot=parseInt(document.getElementById(‚Äòm-prot‚Äô).value)||0;
m.fat=parseInt(document.getElementById(‚Äòm-fat‚Äô).value)||0;m.fiber=parseInt(document.getElementById(‚Äòm-fiber‚Äô).value)||0;
m.desc=document.getElementById(‚Äòm-desc‚Äô).value;
updateDash();renderMeals();closeEditModal();showToast(‚ÄòEntry updated‚Äô);
try{await sb.update(‚Äòmeals‚Äô,`id=eq.${S.editId}`,{cal:m.cal,prot:m.prot,fat:m.fat,fiber:m.fiber,description:m.desc});setSyncStatus(‚Äòok‚Äô);}catch(e){setSyncStatus(‚Äòerr‚Äô);}
}
function closeEditModal(){document.getElementById(‚Äòedit-overlay‚Äô).classList.remove(‚Äòon‚Äô);S.editId=null;}
document.getElementById(‚Äòedit-overlay‚Äô).addEventListener(‚Äòclick‚Äô,function(e){if(e.target===this)closeEditModal();});

function renderHistory(){
const list=document.getElementById(‚Äòhist-list‚Äô);
if(!S.meals.length){list.innerHTML=‚Äô<div class="empty"><div class="ei">‚ö°</div>No history yet.</div>‚Äô;return;}
const seen=new Set(),unique=[];
[‚Ä¶S.meals].reverse().forEach(m=>{const k=m.desc.substring(0,40);if(!seen.has(k)){seen.add(k);unique.push(m);}});
list.innerHTML=unique.map(m=>`<div class="hi"><div class="hi-info"><div class="hi-name">${esc(m.desc.substring(0,52))}${m.desc.length>52?'‚Ä¶':''}</div><div class="hi-meta">${m.type} ¬∑ ${m.time}</div></div><div class="hi-nums"><span class="hc">${m.cal}kcal</span><br><span class="hp">${m.prot}g P</span></div><button class="hi-add" onclick="quickAdd(${m.id})">+</button></div>`).join(‚Äô‚Äô);
}
async function quickAdd(id){
const src=S.meals.find(m=>m.id===id);if(!src)return;
const entry={‚Ä¶src,id:Date.now(),time:new Date().toLocaleTimeString(‚Äòen-US‚Äô,{hour:‚Äò2-digit‚Äô,minute:‚Äò2-digit‚Äô})};
S.meals.push(entry);updateDash();renderMeals();showToast(‚ÄòRe-added ¬∑ ‚Äò+entry.cal+‚Äô kcal‚Äô);
try{await sb.insert(‚Äòmeals‚Äô,{id:entry.id,date:S.activeDate,meal_type:entry.type,description:entry.desc,notes:entry.notes,cal:entry.cal,prot:entry.prot,fat:entry.fat,fiber:entry.fiber,meal_time:entry.time});setSyncStatus(‚Äòok‚Äô);}catch(e){setSyncStatus(‚Äòerr‚Äô);}
}

async function getDinnerRecs(){
const t=totals();const btn=document.getElementById(‚Äòbtn-dinner‚Äô);btn.disabled=true;btn.textContent=‚ÄòGetting ideas‚Ä¶‚Äô;
const cards=document.getElementById(‚Äòdinner-cards‚Äô);
cards.innerHTML=‚Äô<div class="empty"><div class="dots"><span></span><span></span><span></span></div></div>‚Äô;
const rem={cal:Math.max(0,T.cal-t.cal),prot:Math.max(0,T.prot-t.prot)};
const sys=`You are a meal planner optimizing for fat loss and muscle preservation. Targets: 2100 cal, 150g protein, 70g fat, 35g fiber. Respond ONLY with valid JSON, no markdown: {"meals":[{"name":"<n>","cal":<int>,"prot":<int>,"fat":<int>,"fiber":<int>,"badge":"high|balanced|light","note":"<brief tip>"},...]}`;
const prompt=`So far today: ${t.cal} cal, ${t.prot}g protein, ${t.fat}g fat, ${t.fiber}g fiber.\nRemaining: ~${rem.cal} cal, ~${rem.prot}g protein needed.\nSuggest 4 realistic dinner options. Variety: one high-protein, one balanced, one lighter, one wildcard.`;
try{
const data=parseJ(await callAPI([{role:‚Äòuser‚Äô,content:prompt}],sys));
if(data.meals&&data.meals.length){cards.innerHTML=data.meals.map(m=>`<div class="dcard" onclick="selectDinner('${esc(m.name)}',${m.cal},${m.prot},${m.fat},${m.fiber||0})"><div class="dcard-top"><div class="dcard-name">${esc(m.name)}</div><span class="dbadge ${m.badge}">${m.badge}</span></div><div class="dcard-macros"><span class="dm c">${m.cal}kcal</span><span class="dm p">${m.prot}g P</span><span class="dm f">${m.fat}g F</span></div>${m.note?`<div class="dcard-note">${esc(m.note)}</div>`:''}<div class="dcard-tap">tap to log ‚Üí</div></div>`).join(‚Äô‚Äô);}
}catch(e){cards.innerHTML=‚Äô<div class="empty">Failed ‚Äî try again.</div>‚Äô;}
btn.disabled=false;btn.textContent=‚ÄòRefresh ‚Üí‚Äô;
}
function selectDinner(name,cal,prot,fat,fiber){
document.getElementById(‚Äòe-cal‚Äô).value=cal;document.getElementById(‚Äòe-prot‚Äô).value=prot;document.getElementById(‚Äòe-fat‚Äô).value=fat;document.getElementById(‚Äòe-fiber‚Äô).value=fiber;
document.getElementById(‚Äòai-cal‚Äô).textContent=cal;document.getElementById(‚Äòai-prot‚Äô).textContent=prot+‚Äòg‚Äô;document.getElementById(‚Äòai-fat‚Äô).textContent=fat+‚Äòg‚Äô;document.getElementById(‚Äòai-fiber‚Äô).textContent=fiber+‚Äòg‚Äô;
document.getElementById(‚Äòai-desc‚Äô).textContent=name;document.getElementById(‚Äòai-dots‚Äô).style.display=‚Äònone‚Äô;
S.pending={type:‚Äòdinner‚Äô,desc:name,notes:‚Äô‚Äô,cal,prot,fat,fiber};
document.getElementById(‚Äòair‚Äô).classList.add(‚Äòon‚Äô);
document.getElementById(‚Äòair‚Äô).scrollIntoView({behavior:‚Äòsmooth‚Äô,block:‚Äòstart‚Äô});
}

function toggleMenuPaste(){const el=document.getElementById(‚Äòrest-menu‚Äô);const on=el.classList.toggle(‚Äòon‚Äô);document.getElementById(‚Äòrest-toggle‚Äô).textContent=on?‚Äò‚àí hide menu‚Äô:‚Äô+ paste menu (optional)‚Äô;}
function toggleCourse(course,btn){SC[course]=!SC[course];btn.classList.toggle(‚Äòactive‚Äô,SC[course]);}
async function getRestaurantRecs(){
const name=document.getElementById(‚Äòrest-name‚Äô).value.trim();
if(!name){showToast(‚ÄòEnter a restaurant name‚Äô);return;}
const btn=document.getElementById(‚Äòbtn-rest‚Äô);btn.disabled=true;btn.textContent=‚Äô‚Ä¶‚Äô;
const results=document.getElementById(‚Äòrest-results‚Äô);
results.innerHTML=‚Äô<div class="empty"><div class="dots"><span></span><span></span><span></span></div></div>‚Äô;
const t=totals();
const rem={cal:Math.max(0,T.cal-t.cal),prot:Math.max(0,T.prot-t.prot)};
const menu=document.getElementById(‚Äòrest-menu‚Äô).value.trim();
const courses=Object.entries(SC).filter(([,v])=>v).map(([k])=>k);
const sys=`You are a restaurant nutrition optimizer for fat loss and muscle preservation. Targets: 2100 cal, 150g protein, 70g fat, 35g fiber daily. Respond ONLY with valid JSON, no markdown: {"restaurant":"<n>","known":<bool>,"courses":[{"course":"appetizer|main|dessert","name":"<dish>","cal":<int>,"prot":<int>,"fat":<int>,"fiber":<int>,"note":"<tip>"},...],"bestCombo":{"names":"<dish1> + <dish2>","cal":<int>,"prot":<int>,"reasoning":"<1 sentence>"}}`;
const prompt=`Restaurant: ${name}\n${menu?'Menu:\n'+menu+'\n':''}\nSo far today: ${t.cal} cal, ${t.prot}g protein.\nRemaining: ~${rem.cal} cal, ~${rem.prot}g protein.\nCourses needed: ${courses.join(', ')}.\nSuggest 2 options per course that best fit remaining macros. Give best combo order.`;
try{
const d=parseJ(await callAPI([{role:‚Äòuser‚Äô,content:prompt}],sys));
let html=‚Äô‚Äô;
if(!d.known&&!menu)html+=‚Äô<div style="font-family:var(--mono);font-size:9px;color:var(--muted);margin-bottom:6px;">‚ö†Ô∏è Restaurant not in training data ‚Äî suggestions based on cuisine. Paste menu for accuracy.</div>‚Äô;
const byCourse={};(d.courses||[]).forEach(c=>{if(!byCourse[c.course])byCourse[c.course]=[];byCourse[c.course].push(c);});
Object.entries(byCourse).forEach(([course,items])=>{items.forEach((item,i)=>{html+=`<div class="rcard" onclick="selectRestDish('${esc(item.name)}',${item.cal},${item.prot},${item.fat},${item.fiber||0})"><div class="rcard-course">${course}${items.length>1?' ¬∑ option '+(i+1):''}</div><div class="rcard-name">${esc(item.name)}</div><div class="rcard-macros"><span class="dm c">${item.cal}kcal</span><span class="dm p">${item.prot}g P</span><span class="dm f">${item.fat}g F</span></div>${item.note?`<div class="rcard-note">${esc(item.note)}</div>`:''}<div class="rcard-tap">tap to log ‚Üí</div></div>`;});});
if(d.bestCombo)html+=`<div class="rest-combo"><div class="rest-combo-lbl">‚≠ê Best Combo</div><div class="rest-combo-name">${esc(d.bestCombo.names)}</div><div class="rest-combo-macros"><span class="dm c">${d.bestCombo.cal}kcal</span><span class="dm p">${d.bestCombo.prot}g P</span></div><div class="rest-combo-note">${esc(d.bestCombo.reasoning)}</div></div>`;
results.innerHTML=html||‚Äô<div class="empty">No suggestions. Try adding menu text.</div>‚Äô;
}catch(e){results.innerHTML=‚Äô<div class="empty">Failed ‚Äî try again.</div>‚Äô;}
btn.disabled=false;btn.textContent=‚ÄòOptimize ‚Üí‚Äô;
}
function selectRestDish(name,cal,prot,fat,fiber){
document.getElementById(‚Äòe-cal‚Äô).value=cal;document.getElementById(‚Äòe-prot‚Äô).value=prot;document.getElementById(‚Äòe-fat‚Äô).value=fat;document.getElementById(‚Äòe-fiber‚Äô).value=fiber;
document.getElementById(‚Äòai-cal‚Äô).textContent=cal;document.getElementById(‚Äòai-prot‚Äô).textContent=prot+‚Äòg‚Äô;document.getElementById(‚Äòai-fat‚Äô).textContent=fat+‚Äòg‚Äô;document.getElementById(‚Äòai-fiber‚Äô).textContent=fiber+‚Äòg‚Äô;
document.getElementById(‚Äòai-desc‚Äô).textContent=name;document.getElementById(‚Äòai-dots‚Äô).style.display=‚Äònone‚Äô;
S.pending={type:‚Äòdinner‚Äô,desc:name,notes:‚Äô‚Äô,cal,prot,fat,fiber};
document.getElementById(‚Äòair‚Äô).classList.add(‚Äòon‚Äô);
document.getElementById(‚Äòair‚Äô).scrollIntoView({behavior:‚Äòsmooth‚Äô,block:‚Äòstart‚Äô});
}

async function runH2H(){
const aIsText=S.h2hType.a===‚Äòtext‚Äô;const bIsText=S.h2hType.b===‚Äòtext‚Äô;
const aText=document.getElementById(‚Äòh2h-a-text‚Äô).value.trim();const bText=document.getElementById(‚Äòh2h-b-text‚Äô).value.trim();
if(aIsText&&!aText){showToast(‚ÄòDescribe option A‚Äô);return;}
if(bIsText&&!bText){showToast(‚ÄòDescribe option B‚Äô);return;}
if(!aIsText&&!S.h2hPhotoA){showToast(‚ÄòUpload photo for option A‚Äô);return;}
if(!bIsText&&!S.h2hPhotoB){showToast(‚ÄòUpload photo for option B‚Äô);return;}
const btn=document.querySelector(‚Äô.btn-h2h‚Äô);btn.disabled=true;btn.textContent=‚ÄòComparing‚Ä¶‚Äô;
document.getElementById(‚Äòh2h-result‚Äô).classList.remove(‚Äòon‚Äô);
const t=totals();
const sys=`You are a macro optimizer. User targets: 2100 cal, 150g protein, 70g fat, 35g fiber. Goal: fat loss with muscle preservation. Respond ONLY with valid JSON, no markdown: {"winner":"A"|"B","a":{"cal":<int>,"prot":<int>,"fat":<int>,"fiber":<int>},"b":{"cal":<int>,"prot":<int>,"fat":<int>,"fiber":<int>},"reasoning":"<2 sentences>"}`;
const ctx=`So far today: ${t.cal} cal, ${t.prot}g protein. Remaining: ${T.cal-t.cal} cal, ${T.prot-t.prot}g protein.`;
let content;
if(aIsText&&bIsText){content=[{type:‚Äòtext‚Äô,text:`${ctx}\nOption A: ${aText}\nOption B: ${bText}`}];}
else if(!aIsText&&!bIsText){content=[{type:‚Äòimage‚Äô,source:{type:‚Äòbase64‚Äô,media_type:‚Äòimage/jpeg‚Äô,data:S.h2hPhotoA.split(‚Äô,‚Äô)[1]}},{type:‚Äòtext‚Äô,text:‚ÄòThis is Option A.‚Äô},{type:‚Äòimage‚Äô,source:{type:‚Äòbase64‚Äô,media_type:‚Äòimage/jpeg‚Äô,data:S.h2hPhotoB.split(‚Äô,‚Äô)[1]}},{type:‚Äòtext‚Äô,text:`This is Option B. ${ctx} Which is better?`}];}
else if(!aIsText){content=[{type:‚Äòimage‚Äô,source:{type:‚Äòbase64‚Äô,media_type:‚Äòimage/jpeg‚Äô,data:S.h2hPhotoA.split(‚Äô,‚Äô)[1]}},{type:‚Äòtext‚Äô,text:`This is Option A. Option B: ${bText}. ${ctx} Which is better?`}];}
else{content=[{type:‚Äòtext‚Äô,text:`Option A: ${aText}. `},{type:‚Äòimage‚Äô,source:{type:‚Äòbase64‚Äô,media_type:‚Äòimage/jpeg‚Äô,data:S.h2hPhotoB.split(‚Äô,‚Äô)[1]}},{type:‚Äòtext‚Äô,text:`Above is Option B. ${ctx} Which is better?`}];}
try{
const d=parseJ(await callAPI([{role:‚Äòuser‚Äô,content}],sys));
const wr=d.winner;const wName=wr===‚ÄòA‚Äô?(aIsText?aText.substring(0,30):‚ÄòPhoto A‚Äô):(bIsText?bText.substring(0,30):‚ÄòPhoto B‚Äô);
document.getElementById(‚Äòh2h-winner‚Äô).innerHTML=`Winner: <span class="wn">Option ${wr}</span> ‚Äî ${esc(wName)}`;
document.getElementById(‚Äòh2h-compare‚Äô).innerHTML=`<div class="h2h-col${wr==='A'?' winner':''}"><div class="h2h-col-name">Option A</div><div class="h2h-mr"><span class="h2h-ml">Cal</span><span>${d.a.cal}</span></div><div class="h2h-mr"><span class="h2h-ml">Protein</span><span>${d.a.prot}g</span></div><div class="h2h-mr"><span class="h2h-ml">Fat</span><span>${d.a.fat}g</span></div><div class="h2h-mr"><span class="h2h-ml">Fiber</span><span>${d.a.fiber}g</span></div></div><div class="h2h-col${wr==='B'?' winner':''}"><div class="h2h-col-name">Option B</div><div class="h2h-mr"><span class="h2h-ml">Cal</span><span>${d.b.cal}</span></div><div class="h2h-mr"><span class="h2h-ml">Protein</span><span>${d.b.prot}g</span></div><div class="h2h-mr"><span class="h2h-ml">Fat</span><span>${d.b.fat}g</span></div><div class="h2h-mr"><span class="h2h-ml">Fiber</span><span>${d.b.fiber}g</span></div></div>`;
document.getElementById(‚Äòh2h-reasoning‚Äô).textContent=d.reasoning;
document.getElementById(‚Äòh2h-result‚Äô).classList.add(‚Äòon‚Äô);
}catch(e){showToast(‚ÄòComparison failed ‚Äî try again‚Äô,4000);}
btn.disabled=false;btn.textContent=‚ÄòCompare ‚Üí‚Äô;
}

async function getDailySummary(){
const t=totals();const btn=document.getElementById(‚Äòsum-btn‚Äô);
btn.disabled=true;btn.textContent=‚ÄòGenerating‚Ä¶‚Äô;
const prompt=`Date: ${S.activeDate}. Calories: ${t.cal}/${T.cal}. Protein: ${t.prot}g/${T.prot}g. Fat: ${t.fat}g/${T.fat}g. Fiber: ${t.fiber}g/${T.fiber}g. Water: ${S.water}/${T.water} cups. Meals: ${S.meals.map(m=>m.desc).join(', ')}.`;
try{
const text=await callAPI([{role:‚Äòuser‚Äô,content:prompt}],SUMSY);
document.getElementById(‚Äòsum-text‚Äô).textContent=text;
}catch(e){document.getElementById(‚Äòsum-text‚Äô).textContent=‚ÄòFailed to generate ‚Äî try again.‚Äô;}
btn.disabled=false;btn.textContent=‚ÄòRegenerate ‚Üí‚Äô;
}

function esc(s){return String(s).replace(/&/g,‚Äô&‚Äô).replace(/</g,‚Äô<‚Äô).replace(/>/g,‚Äô>‚Äô).replace(/‚Äù/g,‚Äô"‚Äô);}
function showToast(msg,dur){const t=document.getElementById(‚Äòtoast‚Äô);t.textContent=msg;t.classList.add(‚Äòon‚Äô);clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove(‚Äòon‚Äô),dur||2800);}

init();
</script>

</body>
</html>
